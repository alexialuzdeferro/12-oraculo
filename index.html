<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Or√°culo das 12 Guardi√£s - Pombagira</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* --- CONFIGURA√á√ïES VISUAIS E CORES --- */
        :root {
            --cor-roxo: #4b0082;
            --cor-lilas: #e0b0ff;
            --cor-vermelho: #ff0000;
            --cor-preto: #050505;
            --bg-atual: var(--cor-preto);
            --texto-destaque: #ffd700; /* Dourado */
            --cor-acerto: #00ff00; /* Verde neon */
            --cor-erro: #ff0000; /* Vermelho puro */
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--bg-atual);
            color: white;
            overflow-x: hidden;
            transition: background-color 1.5s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- CHUVA DE EMO√á√ïES (BACKGROUND) --- */
        #chuva-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .elemento-chuva {
            position: absolute;
            font-size: 24px;
            animation: cair linear infinite;
            opacity: 0.7;
        }

        @keyframes cair {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0.3; }
        }

        /* --- INTERFACE PRINCIPAL --- */
        #app-container {
            z-index: 10;
            width: 90%;
            max-width: 600px;
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid var(--cor-lilas);
            border-radius: 15px;
            padding: 20px;
            margin-top: 50px;
            margin-bottom: 80px; /* Espa√ßo extra para o contador embaixo */
            box-shadow: 0 0 20px var(--cor-vermelho);
            text-align: center;
            backdrop-filter: blur(5px);
        }

        h1, h2 {
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--texto-destaque);
            text-shadow: 2px 2px 4px #000;
        }

        /* --- CONTADOR GLASSMORPHISM (INTEGRADO) --- */
        #counter {
            position: fixed;
            bottom: 12px;
            right: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.5);
            font-family: Arial, sans-serif; /* Fonte limpa para o contador */
            font-size: 11px;
            padding: 5px 10px;
            border-radius: 12px;
            z-index: 9999;
            opacity: 0.6;
            transition: opacity 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(5px); /* O efeito vidro fosco */
            user-select: none;
            display: flex;
            align-items: center;
        }

        #counter:hover {
            opacity: 0.9;
            background: rgba(255, 255, 255, 0.08);
        }

        #count {
            color: #fff;
            font-weight: 500;
            font-size: 12px;
            margin-left: 4px;
        }

        .dot {
            display: inline-block;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: rgba(74, 222, 128, 0.4);
            margin-left: 6px;
        }

        .dot.online {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        /* --- QUIZ & BOT√ïES --- */
        .pergunta-nivel {
            font-size: 0.8rem;
            color: var(--cor-lilas);
            margin-bottom: 10px;
        }

        .pergunta-texto {
            font-size: 1.2rem;
            margin-bottom: 25px;
            font-weight: bold;
        }

        .opcoes {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        button {
            background: transparent;
            border: 1px solid var(--cor-lilas);
            color: white;
            padding: 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            text-transform: uppercase;
            position: relative;
        }

        button:hover:not(:disabled) {
            background: rgba(255, 0, 0, 0.2);
            border-color: var(--texto-destaque);
            transform: scale(1.02);
        }

        button:disabled {
            cursor: default;
            transform: none;
            opacity: 0.6;
        }

        /* --- FEEDBACK DE ACERTO/ERRO --- */
        button.btn-correto {
            background-color: var(--cor-acerto) !important;
            color: black !important;
            border-color: var(--cor-acerto) !important;
            font-weight: bold;
            box-shadow: 0 0 15px var(--cor-acerto);
        }

        button.btn-incorreto {
            background-color: var(--cor-erro) !important;
            color: white !important;
            border-color: var(--cor-erro) !important;
            font-weight: bold;
            box-shadow: 0 0 15px var(--cor-erro);
        }

        /* --- RESULTADOS E CARDS --- */
        .card-pombagira {
            border: 1px solid var(--texto-destaque);
            padding: 20px;
            margin-top: 20px;
            background: rgba(20, 0, 20, 0.9);
        }
        .audio-msg {
            font-style: italic;
            color: var(--cor-lilas);
            margin: 15px 0;
            padding: 10px;
            border-left: 3px solid var(--cor-vermelho);
        }
        .btn-falar {
            background: var(--cor-lilas);
            color: black;
            font-weight: bold;
            margin-top: 10px;
        }

        .hidden { display: none; }
        
        /* Barra de progresso */
        .progress-bar {
            width: 100%;
            height: 5px;
            background: #333;
            margin-top: 20px;
        }
        .progress-fill {
            height: 100%;
            background: var(--cor-vermelho);
            width: 0%;
            transition: width 0.3s;
        }

    </style>
</head>
<body>

    <div id="chuva-container"></div>

    <div id="counter" title="Total de visitas">
        <span style="opacity: 0.7;">üë§</span>
        <span id="count">0</span>
        <span class="dot" id="status-dot"></span>
    </div>

    <div id="app-container">
        <div id="tela-inicio">
            <h1>Or√°culo das 12 Luas</h1>
            <p>As cartas foram lan√ßadas. As Guardi√£s aguardam.</p>
            <p>Responda a 12 perguntas para receber sua mensagem espiritual.</p>
            <br>
            <button onclick="iniciarQuiz()">Abrir o Portal</button>
        </div>

        <div id="tela-quiz" class="hidden">
            <div class="pergunta-nivel" id="nivel-display">N√çVEL 1 - INICIADO</div>
            <div class="pergunta-texto" id="pergunta-texto">Carregando mist√©rios...</div>
            <div class="opcoes" id="opcoes-container">
                </div>
            <div class="progress-bar"><div class="progress-fill" id="barra-progresso"></div></div>
        </div>

        <div id="tela-resultado" class="hidden">
            <h2>A Sess√£o Encerrou</h2>
            <p>Seu desempenho espiritual: <span id="pontuacao-final"></span></p>
            <hr style="border-color: var(--cor-roxo); opacity: 0.5;">
            
            <h3>Sua Guardi√£ Regente Hoje:</h3>
            <div id="oraculo-destino">
                </div>
            
            <button onclick="location.reload()" style="margin-top: 30px;">Consultar Novamente</button>
        </div>
    </div>

    <script>
        /* --- DADOS DAS 12 POMBAGIRAS --- */
        const pombagirasDB = [
            {
                nome: "Maria Padilha",
                titulo: "A Rainha",
                dominio: "Comando/Realeza",
                msg: "Maria Padilha √© a rainha que governa com sabedoria e for√ßa. Ela ensina a liderar com justi√ßa e a enfrentar desafios com coragem. Seu manto de realeza nos lembra que o poder verdadeiro vem da sabedoria e do respeito."
            },
            {
                nome: "Maria Mulambo",
                titulo: "A Curadora",
                dominio: "Cura/Humildade",
                msg: "Maria Mulambo √© a m√£e que acolhe e cura. Ela ensina que a humildade √© o caminho para a verdadeira transforma√ß√£o. Com suas ervas e seu manto de simplicidade, ela renova nossas for√ßas e purifica nossas almas."
            },
            {
                nome: "Maria Quit√©ria",
                titulo: "A Guerreira",
                dominio: "Guerra/Prote√ß√£o",
                msg: "Maria Quit√©ria √© a guerreira que defende os seus com bravura. Ela empunha a espada da justi√ßa e nos ensina a lutar por nossos direitos. Com ela, aprendemos que a prote√ß√£o vem da coragem e da f√©."
            },
            {
                nome: "Rosa Caveira",
                titulo: "A Guardi√£ dos Ossos",
                dominio: "Justi√ßa/Morte",
                msg: "Rosa Caveira √© a guardi√£ da justi√ßa e do equil√≠brio. Ela nos lembra que a morte √© apenas uma passagem, e que a justi√ßa divina sempre prevalece. Com sua presen√ßa, aprendemos a respeitar os ciclos da vida."
            },
            {
                nome: "Dama da Noite",
                titulo: "O Mist√©rio",
                dominio: "Mist√©rio/Oculto",
                msg: "Dama da Noite √© a guardi√£ dos segredos e da sabedoria oculta. Ela ilumina nosso caminho com a luz da lua e nos ensina a confiar em nossa intui√ß√£o. Com ela, descobrimos que o mist√©rio √© a porta para o conhecimento."
            },
            {
                nome: "Sete Saias",
                titulo: "A Encantada",
                dominio: "Alegria/Intensidade",
                msg: "Sete Saias √© a dan√ßarina que traz a alegria e a cor para nossa vida. Com suas saias coloridas, ela nos ensina a celebrar cada momento e a viver com intensidade. Com ela, a vida se torna uma festa!"
            },
            {
                nome: "Pombagira Cigana",
                titulo: "A N√¥made",
                dominio: "Liberdade/Prosperidade",
                msg: "Pombagira Cigana √© a viajante que abre caminhos e traz prosperidade. Com seu len√ßo colorido e seu baralho, ela nos ensina a confiar no destino e a viver com liberdade. Com ela, a sorte est√° sempre ao nosso lado."
            },
            {
                nome: "Maria Navalha",
                titulo: "A Malandra",
                dominio: "Malandragem/Rua",
                msg: "Maria Navalha √© a protetora das ruas e dos que lutam para sobreviver. Com sua navalha e sua malandragem, ela nos ensina a ser espertos e a enfrentar os desafios da vida com coragem. Com ela, nunca estamos sozinhos."
            },
            {
                nome: "Pombagira da Praia",
                titulo: "A Sereia",
                dominio: "Emo√ß√£o/Limpeza",
                msg: "Pombagira da Praia √© a guardi√£ das √°guas e das emo√ß√µes. Com suas ondas, ela limpa nossa alma e nos ensina a fluir com a vida. Com ela, encontramos paz e renova√ß√£o."
            },
            {
                nome: "Maria Farrapo",
                titulo: "A Transformadora",
                dominio: "Sanidade/Caos",
                msg: "Maria Farrapo √© a transformadora da mente. Com seus farrapos, ela nos ensina que at√© no caos podemos encontrar a sanidade. Com ela, aprendemos a transformar nossas dores em for√ßa."
            },
            {
                nome: "Pombagira Menina",
                titulo: "A Pura",
                dominio: "Renova√ß√£o/Inoc√™ncia",
                msg: "Pombagira Menina √© a guardi√£ da inoc√™ncia e da renova√ß√£o. Com seu sorriso doce, ela nos ensina que sempre podemos recome√ßar. Com ela, encontramos a pureza e a esperan√ßa."
            },
            {
                nome: "Pombagira da Figueira",
                titulo: "A Ancestral",
                dominio: "Raiz/Ancestralidade",
                msg: "Pombagira da Figueira √© a guardi√£ das ra√≠zes e da ancestralidade. Com seus galhos fortes, ela nos conecta aos nossos antepassados e √† sabedoria da terra. Com ela, encontramos for√ßa e pertencimento."
            }
        ];

        /* --- BANCO DE 50 PERGUNTAS DIN√ÇMICAS --- */
        const perguntasBase = [
            { t: "Qual a cor predominante nas velas de Maria Padilha?", r: "Vermelho", o: ["Branco", "Azul", "Vermelho", "Amarelo"], n: 1 },
            { t: "O que significa 'Mulambo' no nome de Maria Mulambo?", r: "Trapo/Farrapo", o: ["Rainha", "Trapo/Farrapo", "Guerreira", "Noite"], n: 1 },
            { t: "Qual objeto simboliza a Pombagira Maria Quit√©ria?", r: "Espada", o: ["Espelho", "Espada", "Baralho", "Concha"], n: 1 },
            { t: "Rosa Caveira √© associada a qual ciclo?", r: "Vida e Morte", o: ["Amor e √ìdio", "Vida e Morte", "Dia e Noite", "Riqueza e Pobreza"], n: 2 },
            { t: "Qual Pombagira trabalha com o Baralho?", r: "Pombagira Cigana", o: ["Maria Padilha", "Sete Saias", "Pombagira Cigana", "Maria Navalha"], n: 1 },
            { t: "Onde atua principalmente a Pombagira da Praia?", r: "No mar/Areia", o: ["Na mata", "No cemit√©rio", "No mar/Areia", "Na encruzilhada de terra"], n: 1 },
            { t: "Qual o dom√≠nio de Maria Navalha?", r: "Malandragem", o: ["Realeza", "Malandragem", "Cura", "Inoc√™ncia"], n: 2 },
            { t: "Pombagira Menina est√° ligada a qual energia?", r: "Renova√ß√£o", o: ["Guerra", "Morte", "Renova√ß√£o", "Caos"], n: 1 },
            { t: "Qual √°rvore representa uma Pombagira ancestral?", r: "Figueira", o: ["Salgueiro", "Figueira", "Carvalho", "Jaqueira"], n: 2 },
            { t: "O que Maria Padilha segura para representar a verdade?", r: "Espelho", o: ["Espada", "Espelho", "Copo", "Caveira"], n: 2 },
            { t: "Sete Saias √© conhecida por qual caracter√≠stica?", r: "Alegria e Dan√ßa", o: ["Sil√™ncio", "Tristeza", "Alegria e Dan√ßa", "Guerra"], n: 1 },
            { t: "Dama da Noite atua sob a luz de qual astro?", r: "Lua", o: ["Sol", "Marte", "Lua", "V√™nus"], n: 1 },
            { t: "Qual Pombagira lida com a sanidade e o caos mental?", r: "Maria Farrapo", o: ["Maria Mulambo", "Maria Farrapo", "Rosa Caveira", "Menina"], n: 3 },
            { t: "Qual a oferenda cl√°ssica para Maria Quit√©ria?", r: "Pimenta e Vinho", o: ["Leite e Mel", "Pimenta e Vinho", "√Ågua do mar", "Doces"], n: 2 },
            { t: "Quem √© a 'Rainha das Pombagiras'?", r: "Maria Padilha", o: ["Maria Mulambo", "Maria Padilha", "Cigana", "Figueira"], n: 1 },
            { t: "Qual Pombagira usa saias muito coloridas?", r: "Sete Saias", o: ["Rosa Caveira", "Dama da Noite", "Sete Saias", "Maria Navalha"], n: 1 },
            { t: "O que representa o 'Len√ßo' da Pombagira Cigana?", r: "Liberdade/N√¥made", o: ["Pris√£o", "Luto", "Liberdade/N√¥made", "Guerra"], n: 2 },
            { t: "Maria Navalha usa qual objeto para defesa?", r: "Navalha", o: ["Tridente", "Navalha", "Cetro", "Livro"], n: 1 },
            { t: "Qual Pombagira recebe oferendas de conchas?", r: "Pombagira da Praia", o: ["Maria Padilha", "Pombagira da Praia", "Quit√©ria", "Mulambo"], n: 2 },
            { t: "Maria Mulambo auxilia principalmente em:", r: "Cura Emocional", o: ["Vingan√ßa", "Cura Emocional", "Guerra F√≠sica", "Jogos de Azar"], n: 2 },
            { t: "Qual cor de vela √© comum para Rosa Caveira?", r: "Preta/Vermelha", o: ["Rosa", "Azul", "Preta/Vermelha", "Amarela"], n: 2 },
            { t: "Dama da Noite revela o qu√™?", r: "Segredos Ocultos", o: ["O Futuro Financeiro", "Segredos Ocultos", "Nomes de Inimigos", "Receitas"], n: 3 },
            { t: "Pombagira Menina aceita qual tipo de oferenda?", r: "Doces e Bonecas", o: ["Cacha√ßa", "Doces e Bonecas", "Charutos", "Pimenta"], n: 2 },
            { t: "A Figueira conecta o m√©dium a qu√™?", r: "Ancestralidade", o: ["Ao Futuro", "Ao Espa√ßo", "Ancestralidade", "Ao Dinheiro"], n: 3 },
            { t: "Quem √© associada √† hero√≠na Joana Ang√©lica?", r: "Maria Quit√©ria", o: ["Maria Padilha", "Maria Quit√©ria", "Dama da Noite", "Cigana"], n: 3 },
            { t: "Qual o s√≠mbolo de poder de Maria Padilha?", r: "Cetro e Coroa", o: ["Navalha", "Cetro e Coroa", "Capa Preta", "Pandeiro"], n: 2 },
            { t: "Ervas como Arruda e Alecrim s√£o de qual Pombagira?", r: "Maria Mulambo", o: ["Maria Mulambo", "Rosa Caveira", "Padilha", "Navalha"], n: 3 },
            { t: "O que simboliza a 'Caveira' para Rosa Caveira?", r: "Transforma√ß√£o", o: ["Medo", "Fim tr√°gico", "Transforma√ß√£o", "Doen√ßa"], n: 3 },
            { t: "Sete Saias trabalha com a quebra de:", r: "Rotinas", o: ["Ossos", "Rotinas", "Contratos", "Vidros"], n: 2 },
            { t: "Qual elemento rege a Pombagira da Praia?", r: "√Ågua", o: ["Fogo", "Terra", "Ar", "√Ågua"], n: 1 },
            { t: "Maria Farrapo ajuda a equilibrar:", r: "Mentes Perturbadas", o: ["Contas Banc√°rias", "Mentes Perturbadas", "Brigas de Casal", "Velas"], n: 3 },
            { t: "Qual Pombagira tem energia 'Maternal'?", r: "Maria Mulambo", o: ["Maria Navalha", "Maria Mulambo", "Rosa Caveira", "Dama da Noite"], n: 2 },
            { t: "Flores Noturnas s√£o para:", r: "Dama da Noite", o: ["Cigana", "Menina", "Dama da Noite", "Praia"], n: 2 },
            { t: "Moedas douradas s√£o oferendas para:", r: "Pombagira Cigana", o: ["Maria Mulambo", "Rosa Caveira", "Pombagira Cigana", "Farrapo"], n: 1 },
            { t: "Maria Navalha √© associada a qual ambiente?", r: "Rua/Lapa", o: ["Pal√°cio", "Rua/Lapa", "Floresta", "Praia"], n: 2 },
            { t: "A cor Rosa √© predominante em:", r: "Pombagira Menina", o: ["Padilha", "Quit√©ria", "Pombagira Menina", "Caveira"], n: 1 },
            { t: "Ra√≠zes profundas simbolizam:", r: "Pombagira da Figueira", o: ["Sete Saias", "Pombagira da Figueira", "Mulambo", "Navalha"], n: 2 },
            { t: "O nome 'Padilha' vem de uma corte:", r: "Francesa/Espanhola", o: ["Africana", "Francesa/Espanhola", "Brasileira", "Chinesa"], n: 3 },
            { t: "Qual Pombagira usa chap√©u panam√° ou de malandro?", r: "Maria Navalha", o: ["Maria Padilha", "Maria Navalha", "Cigana", "Quit√©ria"], n: 2 },
            { t: "Cristais como Ametista agradam:", r: "Dama da Noite", o: ["Maria Quit√©ria", "Dama da Noite", "Maria Farrapo", "Mulambo"], n: 3 },
            { t: "Quem √© a 'Guardi√£ da Justi√ßa Divina'?", r: "Rosa Caveira", o: ["Rosa Caveira", "Sete Saias", "Menina", "Praia"], n: 2 },
            { t: "A Pombagira Cigana traz a sabedoria de qual povo?", r: "Povo Cigano", o: ["Povo N√≥rdico", "Povo Cigano", "Povo Ind√≠gena", "Povo Eg√≠pcio"], n: 1 },
            { t: "Quem trabalha com 'fechamento de ciclos'?", r: "Rosa Caveira", o: ["Cigana", "Rosa Caveira", "Menina", "Sete Saias"], n: 3 },
            { t: "Qual Pombagira ajuda na 'sobreviv√™ncia'?", r: "Maria Navalha", o: ["Maria Padilha", "Maria Navalha", "Dama da Noite", "Figueira"], n: 2 },
            { t: "Maria Farrapo transforma o Caos em:", r: "Clareza", o: ["Mais Caos", "Clareza", "Dinheiro", "Fogo"], n: 3 },
            { t: "Qual a energia de Sete Saias?", r: "Vibrante e Sensual", o: ["Calma e Fria", "Triste e Lenta", "Vibrante e Sensual", "Maternal"], n: 2 },
            { t: "Pombagira da Figueira usa velas:", r: "Verdes ou Marrons", o: ["Pretas", "Roxas", "Verdes ou Marrons", "Rosas"], n: 3 },
            { t: "Qual Pombagira protege a 'Inoc√™ncia'?", r: "Pombagira Menina", o: ["Maria Padilha", "Maria Quit√©ria", "Pombagira Menina", "Navalha"], n: 2 },
            { t: "Onde Maria Mulambo cura as feridas?", r: "Na Alma", o: ["No Corpo F√≠sico apenas", "Na Alma", "Nas Roupas", "No Ch√£o"], n: 2 },
            { t: "A chuva de vinho √© associada a:", r: "Celebra√ß√£o das Guardi√£s", o: ["Tristeza", "Celebra√ß√£o das Guardi√£s", "Frio", "Medo"], n: 1 }
        ];

        /* --- L√ìGICA DO APP --- */
        let perguntasSelecionadas = [];
        let indiceAtual = 0;
        let acertos = 0;

        // Anima√ß√£o de Chuva
        const emojis = ['üç∑', 'üî±', 'üåπ', 'üíÉ', 'üî•', 'üïØÔ∏è', 'üö¨', 'üåô', 'üíÄ', 'üó°Ô∏è'];
        function criarChuva() {
            const container = document.getElementById('chuva-container');
            setInterval(() => {
                const el = document.createElement('div');
                el.classList.add('elemento-chuva');
                el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
                el.style.left = Math.random() * 100 + 'vw';
                el.style.animationDuration = (Math.random() * 3 + 2) + 's';
                container.appendChild(el);
                
                setTimeout(() => { el.remove(); }, 5000);
            }, 300);
        }

        // Misturador de Array
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Troca de Cores do Tema
        const cores = ['var(--cor-roxo)', 'var(--cor-lilas)', 'var(--cor-vermelho)', 'var(--cor-preto)'];
        function mudarCorFundo() {
            const corNova = cores[Math.floor(Math.random() * cores.length)];
            document.body.style.backgroundColor = corNova;
        }

        // --- SISTEMA DE QUIZ ---
        function iniciarQuiz() {
            document.getElementById('tela-inicio').classList.add('hidden');
            document.getElementById('tela-quiz').classList.remove('hidden');
            
            perguntasSelecionadas = shuffle([...perguntasBase]).slice(0, 12);
            indiceAtual = 0;
            acertos = 0;
            mostrarPergunta();
        }

        function mostrarPergunta() {
            if (indiceAtual >= 12) {
                finalizarQuiz();
                return;
            }

            const p = perguntasSelecionadas[indiceAtual];
            document.getElementById('nivel-display').innerText = `PERGUNTA ${indiceAtual + 1}/12 - N√çVEL ${p.n}`;
            document.getElementById('pergunta-texto').innerText = p.t;
            
            const opcoesDiv = document.getElementById('opcoes-container');
            opcoesDiv.innerHTML = '';

            const opcoesMisturadas = shuffle([...p.o]);

            opcoesMisturadas.forEach(opcao => {
                const btn = document.createElement('button');
                btn.innerText = opcao;
                btn.onclick = function() { verificarResposta(this, opcao, p.r); };
                opcoesDiv.appendChild(btn);
            });

            document.getElementById('barra-progresso').style.width = ((indiceAtual) / 12 * 100) + '%';
        }

        function verificarResposta(btnElement, escolha, correta) {
            // Desabilita todos os bot√µes para evitar clique duplo
            const todosBotoes = document.querySelectorAll('#opcoes-container button');
            todosBotoes.forEach(b => b.disabled = true);

            // Muda cor do fundo
            mudarCorFundo();

            // Aplica cor de acerto ou erro
            if (escolha === correta) {
                btnElement.classList.add('btn-correto');
                acertos++;
            } else {
                btnElement.classList.add('btn-incorreto');
            }

            // Aguarda 1 segundo para o usu√°rio ver a cor, depois avan√ßa
            setTimeout(() => {
                indiceAtual++;
                mostrarPergunta();
            }, 1000);
        }

        function finalizarQuiz() {
            document.getElementById('tela-quiz').classList.add('hidden');
            document.getElementById('tela-resultado').classList.remove('hidden');
            
            document.getElementById('pontuacao-final').innerText = `${acertos} de 12 acertos`;

            const pombagiraDoDia = pombagirasDB[Math.floor(Math.random() * pombagirasDB.length)];
            
            const divDestino = document.getElementById('oraculo-destino');
            divDestino.innerHTML = `
                <div class="card-pombagira">
                    <h3>${pombagiraDoDia.nome}</h3>
                    <p style="color: #ccc; font-size: 0.9rem;">${pombagiraDoDia.titulo} | ${pombagiraDoDia.dominio}</p>
                    <div class="audio-msg">"${pombagiraDoDia.msg}"</div>
                    <button class="btn-falar" onclick="lerMensagem('${pombagiraDoDia.msg.replace(/'/g, "\\'")}')">üîä OUVIR MENSAGEM</button>
                </div>
            `;
        }

        function lerMensagem(texto) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(texto);
                utterance.lang = 'pt-BR';
                utterance.rate = 0.9;
                utterance.pitch = 0.8;
                window.speechSynthesis.speak(utterance);
            } else {
                alert("Seu navegador n√£o suporta √°udio espiritual.");
            }
        }

        /* --- L√ìGICA DO CONTADOR (SUPABASE) --- */
        // Configura√ß√£o √öNICA para todo o site
        const SUPABASE_URL = 'https://qgnprifuachmfxoaalax.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnbnByaWZ1YWNobWZ4b2FhbGF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzODU5MDcsImV4cCI6MjA4MDk2MTkwN30.sKSYFhcI-zflr9RUKXpWF0_5sc6foDG7yxdEirtE0W4';
        
        // Nome √öNICO para todo o site
        const SITE_NAME = 'site_alexialuzdeferro';
        
        async function initCounter() {
            try {
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                
                // Verificar se j√° contamos nesta sess√£o
                if (!sessionStorage.getItem('site_visited')) {
                    // Incrementar contador √∫nico
                    await incrementUniqueCounter(supabase);
                    sessionStorage.setItem('site_visited', 'true');
                    document.getElementById('status-dot').classList.add('online');
                } else {
                    // Apenas mostrar o valor atual
                    await showCurrentCount(supabase);
                    document.getElementById('status-dot').classList.add('online');
                }
                
            } catch (error) {
                // Modo offline silencioso
                useOfflineCounter();
            }
        }
        
        async function incrementUniqueCounter(supabase) {
            try {
                const { data: existing } = await supabase
                    .from('page_views')
                    .select('view_count')
                    .eq('page_name', SITE_NAME)
                    .single();
                
                const current = existing?.view_count || 0;
                const newCount = current + 1;
                
                await supabase
                    .from('page_views')
                    .upsert({
                        page_name: SITE_NAME,
                        view_count: newCount,
                        last_updated: new Date().toISOString()
                    }, {
                        onConflict: 'page_name'
                    });
                
                const countEl = document.getElementById('count');
                countEl.textContent = newCount;
                countEl.style.transform = 'scale(1.3)';
                setTimeout(() => countEl.style.transform = 'scale(1)', 200);
                
            } catch (error) {
                console.error('Erro:', error);
                throw error;
            }
        }
        
        async function showCurrentCount(supabase) {
            try {
                const { data } = await supabase
                    .from('page_views')
                    .select('view_count')
                    .eq('page_name', SITE_NAME)
                    .single();
                
                if (data) {
                    document.getElementById('count').textContent = data.view_count;
                }
            } catch (error) {
                console.error('Erro ao buscar:', error);
            }
        }
        
        function useOfflineCounter() {
            let local = localStorage.getItem('local_site_views') || 0;
            local = parseInt(local) + 1;
            localStorage.setItem('local_site_views', local);
            
            document.getElementById('count').textContent = local;
            document.getElementById('count').style.opacity = '0.7';
            document.getElementById('status-dot').style.background = 'rgba(251, 191, 36, 0.5)';
        }

        // Inicializa√ß√£o Geral
        window.onload = () => {
            criarChuva();
            initCounter(); // Inicia o contador
        };
    </script>
</body>
</html>

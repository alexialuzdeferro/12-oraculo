<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Or√°culo das 12 Guardi√£s</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* --- CONFIGURA√á√ïES VISUAIS E CORES --- */
        :root {
            --cor-roxo: #4b0082;
            --cor-lilas: #e0b0ff;
            --cor-vermelho: #ff0000;
            --cor-preto: #050505;
            --bg-atual: var(--cor-preto);
            --texto-destaque: #ffd700; /* Dourado */
            --cor-acerto: #00ff00;
            --cor-erro: #ff0000;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--bg-atual);
            color: white;
            overflow-x: hidden;
            transition: background-color 1.5s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- BACKGROUND CHUVA --- */
        #chuva-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .elemento-chuva {
            position: absolute;
            font-size: 24px;
            animation: cair linear infinite;
            opacity: 0.7;
        }

        @keyframes cair {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0.3; }
        }

        /* --- CONTAINER PRINCIPAL (VIDRO) --- */
        #app-container {
            z-index: 10;
            width: 95%; /* Um pouco mais largo para caber os 3 bot√µes em mobile */
            max-width: 750px;
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid var(--cor-lilas);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            margin-bottom: 80px;
            box-shadow: 0 0 20px var(--cor-vermelho);
            text-align: center;
            backdrop-filter: blur(5px);
            position: relative;
        }

        /* --- NAVEGA√á√ÉO (ABAS E PORTAL) --- */
        .nav-tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* Permite quebrar linha em telas muito pequenas */
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
        }

        .nav-btn {
            background: transparent;
            border: 1px solid var(--cor-lilas);
            color: var(--cor-lilas);
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            border-radius: 20px;
            transition: all 0.3s;
            text-decoration: none; /* Para o link parecer bot√£o */
            display: inline-block;
        }

        .nav-btn.active {
            background: var(--cor-lilas);
            color: black;
            box-shadow: 0 0 10px var(--cor-lilas);
            font-weight: bold;
        }

        .nav-btn:hover {
            transform: scale(1.05);
        }

        /* Estilo do Bot√£o Portal Pulsante */
        .btn-portal-destaque {
            background-color: var(--texto-destaque) !important; /* Dourado s√≥lido */
            color: black !important;
            font-weight: bold;
            border: none !important;
            animation: pulsar-destaque 2s infinite ease-in-out;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        @keyframes pulsar-destaque {
            0% { box-shadow: 0 0 5px var(--texto-destaque); transform: scale(1); }
            50% { box-shadow: 0 0 25px var(--texto-destaque), 0 0 35px var(--cor-vermelho); transform: scale(1.08); }
            100% { box-shadow: 0 0 5px var(--texto-destaque); transform: scale(1); }
        }


        h1, h2, h3 {
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--texto-destaque);
            text-shadow: 2px 2px 4px #000;
        }

        /* --- CONTADOR GLASSMORPHISM --- */
        #counter {
            position: fixed;
            bottom: 12px;
            right: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.5);
            font-family: Arial, sans-serif;
            font-size: 11px;
            padding: 5px 10px;
            border-radius: 12px;
            z-index: 9999;
            opacity: 0.6;
            transition: opacity 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(5px);
            user-select: none;
            display: flex;
            align-items: center;
        }
        #counter:hover { opacity: 0.9; background: rgba(255, 255, 255, 0.08); }
        .dot { display: inline-block; width: 4px; height: 4px; border-radius: 50%; background: rgba(74, 222, 128, 0.4); margin-left: 6px; }
        .dot.online { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }

        /* --- QUIZ --- */
        .pergunta-nivel { font-size: 0.8rem; color: var(--cor-lilas); margin-bottom: 10px; }
        .pergunta-texto { font-size: 1.2rem; margin-bottom: 25px; font-weight: bold; }
        .opcoes { display: flex; flex-direction: column; gap: 10px; }
        
        .quiz-btn {
            background: transparent;
            border: 1px solid var(--cor-lilas);
            color: white;
            padding: 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            text-transform: uppercase;
        }
        .quiz-btn:hover:not(:disabled) { background: rgba(255, 0, 0, 0.2); border-color: var(--texto-destaque); transform: scale(1.02); }
        .quiz-btn.btn-correto { background-color: var(--cor-acerto) !important; color: black !important; font-weight: bold; box-shadow: 0 0 15px var(--cor-acerto); }
        .quiz-btn.btn-incorreto { background-color: var(--cor-erro) !important; color: white !important; font-weight: bold; box-shadow: 0 0 15px var(--cor-erro); }

        /* --- GRID DE PERFIS (NOVA ABA) --- */
        .perfis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            text-align: left;
            max-height: 65vh;
            overflow-y: auto;
            padding-right: 5px;
        }
        /* Scrollbar estilizada */
        .perfis-grid::-webkit-scrollbar { width: 5px; }
        .perfis-grid::-webkit-scrollbar-thumb { background: var(--cor-vermelho); border-radius: 5px; }
        .perfis-grid::-webkit-scrollbar-track { background: #111; }

        .card-perfil {
            background: rgba(20, 0, 20, 0.6);
            border: 1px solid #333;
            border-left: 3px solid var(--cor-lilas);
            padding: 15px;
            transition: 0.3s;
        }
        .card-perfil:hover {
            border-left: 3px solid var(--cor-vermelho);
            background: rgba(40, 0, 0, 0.6);
        }
        .card-perfil h4 { color: var(--texto-destaque); margin: 0 0 5px 0; text-transform: uppercase; }
        .card-perfil .meta { font-size: 0.8rem; color: #aaa; margin-bottom: 10px; font-style: italic; }
        .card-perfil p { font-size: 0.9rem; line-height: 1.4; color: #ddd; }
        .detalhe-item { font-size: 0.8rem; margin-top: 5px; color: var(--cor-lilas); }

        /* --- UTILS --- */
        .hidden { display: none !important; }
        .progress-bar { width: 100%; height: 5px; background: #333; margin-top: 20px; }
        .progress-fill { height: 100%; background: var(--cor-vermelho); width: 0%; transition: width 0.3s; }
        
        /* Card Resultado */
        .card-pombagira { border: 1px solid var(--texto-destaque); padding: 20px; margin-top: 20px; background: rgba(20, 0, 20, 0.9); }
        .audio-msg { font-style: italic; color: var(--cor-lilas); margin: 15px 0; padding: 10px; border-left: 3px solid var(--cor-vermelho); }

    </style>
</head>
<body>

    <div id="chuva-container"></div>

    <div id="counter" title="Total de visitas">
        <span style="opacity: 0.7;">üë§</span>
        <span id="count">0</span>
        <span class="dot" id="status-dot"></span>
    </div>

    <div id="app-container">
        <nav class="nav-tabs">
            <button class="nav-btn active" onclick="mudarAba('oraculo')" id="btn-oraculo">O OR√ÅCULO</button>
            <button class="nav-btn" onclick="mudarAba('grimorio')" id="btn-grimorio">O GRIM√ìRIO (12)</button>
            
            <a href="https://bio.site/AlmasdePombagira" target="_blank" class="nav-btn btn-portal-destaque">
                PORTAL ‚áó
            </a>
        </nav>

        <div id="aba-oraculo">
            <div id="tela-inicio">
                <h1>Or√°culo das 12 Luas</h1>
                <p>Responda a 12 perguntas e descubra quem rege seu caminho hoje.</p>
                <br>
                <button class="quiz-btn" onclick="iniciarQuiz()">Abrir o Portal</button>
            </div>

            <div id="tela-quiz" class="hidden">
                <div class="pergunta-nivel" id="nivel-display">N√çVEL 1</div>
                <div class="pergunta-texto" id="pergunta-texto">...</div>
                <div class="opcoes" id="opcoes-container"></div>
                <div class="progress-bar"><div class="progress-fill" id="barra-progresso"></div></div>
            </div>

            <div id="tela-resultado" class="hidden">
                <h2>Sess√£o Encerrada</h2>
                <p>Desempenho: <span id="pontuacao-final"></span></p>
                <hr style="border-color: var(--cor-roxo); opacity: 0.5;">
                
                <h3>Sua Guardi√£ Regente:</h3>
                <div id="oraculo-destino"></div>
                
                <button class="quiz-btn" onclick="location.reload()" style="margin-top: 30px;">Consultar Novamente</button>
            </div>
        </div>

        <div id="aba-grimorio" class="hidden">
            <h2>As 12 Guardi√£s</h2>
            <p style="font-size: 0.8rem; margin-bottom: 20px;">Breve descri√ß√£o e arqu√©tipos das entidades.</p>
            
            <div class="perfis-grid" id="grid-perfis">
                </div>
        </div>
    </div>

    <script>
        /* --- DADOS COMPLETOS (Baseado no seu primeiro prompt) --- */
        const pombagirasDB = [
            {
                nome: "Maria Padilha",
                titulo: "A Rainha",
                dominio: "Comando/Realeza",
                desc: "Associada ao poder, lideran√ßa e autoridade. Seu nome refere-se √† realeza e for√ßa feminina.",
                detalhes: "Simbolismo: Coroa, cetro, espelhos. Trabalhos: Lideran√ßa, justi√ßa e prote√ß√£o.",
                msg: "Maria Padilha √© a rainha que governa com sabedoria e for√ßa. Ela ensina a liderar com justi√ßa e a enfrentar desafios com coragem."
            },
            {
                nome: "Maria Mulambo",
                titulo: "A Curadora",
                dominio: "Cura/Humildade",
                desc: "Pombagira da cura espiritual e f√≠sica. 'Mulambo' significa simplicidade; ela cura feridas da alma.",
                detalhes: "Simbolismo: Vestes simples, ervas. Trabalhos: Cura, limpeza espiritual, renova√ß√£o.",
                msg: "Maria Mulambo √© a m√£e que acolhe e cura. Ela ensina que a humildade √© o caminho para a verdadeira transforma√ß√£o."
            },
            {
                nome: "Maria Quit√©ria",
                titulo: "A Guerreira",
                dominio: "Guerra/Prote√ß√£o",
                desc: "Guerreira destemida, associada √† coragem e luta. Refer√™ncia √† hero√≠na brasileira.",
                detalhes: "Simbolismo: Espada, escudo. Trabalhos: Batalhas espirituais, coragem e defesa.",
                msg: "Maria Quit√©ria √© a guerreira que defende os seus com bravura. Ela empunha a espada da justi√ßa."
            },
            {
                nome: "Rosa Caveira",
                titulo: "Guardi√£ dos Ossos",
                dominio: "Justi√ßa/Morte",
                desc: "Associada √† justi√ßa divina e ao ciclo de vida e morte. Guardi√£ dos portais.",
                detalhes: "Simbolismo: Caveira, rosas pretas. Trabalhos: Fechamento de ciclos, justi√ßa, prote√ß√£o contra magia.",
                msg: "Rosa Caveira √© a guardi√£ da justi√ßa e do equil√≠brio. Ela nos lembra que a justi√ßa divina sempre prevalece."
            },
            {
                nome: "Dama da Noite",
                titulo: "O Mist√©rio",
                dominio: "Mist√©rio/Oculto",
                desc: "Pombagira da intui√ß√£o e segredos. Atua nas sombras revelando verdades.",
                detalhes: "Simbolismo: Lua, estrelas. Trabalhos: Intui√ß√£o, revela√ß√£o de segredos, mediunidade.",
                msg: "Dama da Noite √© a guardi√£ dos segredos. Ela ilumina nosso caminho com a luz da lua e intui√ß√£o."
            },
            {
                nome: "Sete Saias",
                titulo: "A Encantada",
                dominio: "Alegria/Intensidade",
                desc: "Pombagira da alegria, dan√ßa e vibra√ß√£o intensa da vida. Traz cor e movimento.",
                detalhes: "Simbolismo: Saias coloridas, m√∫sica. Trabalhos: Prosperidade, amor, quebra de rotina.",
                msg: "Sete Saias √© a dan√ßarina que traz a alegria. Ela nos ensina a celebrar cada momento."
            },
            {
                nome: "Pombagira Cigana",
                titulo: "A N√¥made",
                dominio: "Liberdade/Prosperidade",
                desc: "Representa a liberdade, caminhos abertos e a sabedoria do povo cigano.",
                detalhes: "Simbolismo: Baralho, moedas, len√ßo. Trabalhos: Viagens, prosperidade, sorte.",
                msg: "Pombagira Cigana √© a viajante que abre caminhos. Ela nos ensina a confiar no destino e viver com liberdade."
            },
            {
                nome: "Maria Navalha",
                titulo: "A Malandra",
                dominio: "Malandragem/Rua",
                desc: "Protetora das ruas, da ast√∫cia e da sobreviv√™ncia. Mestra na defesa r√°pida.",
                detalhes: "Simbolismo: Navalha, chap√©u. Trabalhos: Prote√ß√£o de rua, esperteza, resolu√ß√£o de conflitos.",
                msg: "Maria Navalha √© a protetora das ruas. Ela nos ensina a ser espertos e enfrentar desafios."
            },
            {
                nome: "Pombagira da Praia",
                titulo: "A Sereia",
                dominio: "Emo√ß√£o/Limpeza",
                desc: "Conex√£o com o mar e as √°guas. Atua nas emo√ß√µes profundas e limpeza.",
                detalhes: "Simbolismo: Conchas, √°gua do mar. Trabalhos: Emo√ß√µes, limpeza, renova√ß√£o.",
                msg: "Pombagira da Praia √© a guardi√£ das √°guas. Com suas ondas, ela limpa nossa alma."
            },
            {
                nome: "Maria Farrapo",
                titulo: "A Transformadora",
                dominio: "Sanidade/Caos",
                desc: "Atua na fronteira da sanidade. Transforma o caos mental em clareza.",
                detalhes: "Simbolismo: Tecidos rasgados. Trabalhos: Sa√∫de mental, quebra de padr√µes.",
                msg: "Maria Farrapo √© a transformadora da mente. Ela nos ensina que at√© no caos existe sanidade."
            },
            {
                nome: "Pombagira Menina",
                titulo: "A Pura",
                dominio: "Renova√ß√£o/Inoc√™ncia",
                desc: "Energia de renova√ß√£o e recome√ßo. Pureza aliada √† for√ßa espiritual.",
                detalhes: "Simbolismo: Bonecas, rosas claras. Trabalhos: Novos come√ßos, cura interior.",
                msg: "Pombagira Menina √© a guardi√£ da renova√ß√£o. Ela nos ensina que sempre podemos recome√ßar."
            },
            {
                nome: "Pombagira da Figueira",
                titulo: "A Ancestral",
                dominio: "Raiz/Ancestralidade",
                desc: "Conex√£o profunda com a terra e ancestrais. Sabedoria antiga.",
                detalhes: "Simbolismo: Ra√≠zes, figueira. Trabalhos: Ancestralidade, prote√ß√£o familiar.",
                msg: "Pombagira da Figueira √© a guardi√£ das ra√≠zes. Ela nos conecta aos nossos antepassados."
            }
        ];

        /* --- PERGUNTAS (Banco reduzido para o exemplo funcionar, use o seu completo) --- */
        const perguntasBase = [
            { t: "Qual a cor predominante nas velas de Maria Padilha?", r: "Vermelho", o: ["Branco", "Azul", "Vermelho", "Amarelo"], n: 1 },
            { t: "O que significa 'Mulambo' no nome de Maria Mulambo?", r: "Trapo/Farrapo", o: ["Rainha", "Trapo/Farrapo", "Guerreira", "Noite"], n: 1 },
            { t: "Qual objeto simboliza a Pombagira Maria Quit√©ria?", r: "Espada", o: ["Espelho", "Espada", "Baralho", "Concha"], n: 1 },
            { t: "Rosa Caveira √© associada a qual ciclo?", r: "Vida e Morte", o: ["Amor e √ìdio", "Vida e Morte", "Dia e Noite", "Riqueza e Pobreza"], n: 2 },
            { t: "Qual Pombagira trabalha com o Baralho?", r: "Pombagira Cigana", o: ["Maria Padilha", "Sete Saias", "Pombagira Cigana", "Maria Navalha"], n: 1 },
            { t: "Onde atua principalmente a Pombagira da Praia?", r: "No mar/Areia", o: ["Na mata", "No cemit√©rio", "No mar/Areia", "Na encruzilhada de terra"], n: 1 },
            { t: "Qual o dom√≠nio de Maria Navalha?", r: "Malandragem", o: ["Realeza", "Malandragem", "Cura", "Inoc√™ncia"], n: 2 },
            { t: "Pombagira Menina est√° ligada a qual energia?", r: "Renova√ß√£o", o: ["Guerra", "Morte", "Renova√ß√£o", "Caos"], n: 1 },
            { t: "Qual √°rvore representa uma Pombagira ancestral?", r: "Figueira", o: ["Salgueiro", "Figueira", "Carvalho", "Jaqueira"], n: 2 },
            { t: "O que Maria Padilha segura para representar a verdade?", r: "Espelho", o: ["Espada", "Espelho", "Copo", "Caveira"], n: 2 },
            { t: "Sete Saias √© conhecida por qual caracter√≠stica?", r: "Alegria e Dan√ßa", o: ["Sil√™ncio", "Tristeza", "Alegria e Dan√ßa", "Guerra"], n: 1 },
            { t: "Dama da Noite atua sob a luz de qual astro?", r: "Lua", o: ["Sol", "Marte", "Lua", "V√™nus"], n: 1 },
            { t: "Qual Pombagira lida com a sanidade e o caos mental?", r: "Maria Farrapo", o: ["Maria Mulambo", "Maria Farrapo", "Rosa Caveira", "Menina"], n: 3 },
            { t: "Qual a oferenda cl√°ssica para Maria Quit√©ria?", r: "Pimenta e Vinho", o: ["Leite e Mel", "Pimenta e Vinho", "√Ågua do mar", "Doces"], n: 2 },
            { t: "Quem √© a 'Rainha das Pombagiras'?", r: "Maria Padilha", o: ["Maria Mulambo", "Maria Padilha", "Cigana", "Figueira"], n: 1 }
            // ... (Voc√™ pode colar as outras 35 perguntas aqui do c√≥digo anterior)
        ];

        /* --- L√ìGICA DO SISTEMA --- */
        let perguntasSelecionadas = [];
        let indiceAtual = 0;
        let acertos = 0;

        // Gerenciamento de Abas
        function mudarAba(aba) {
            const oraculoDiv = document.getElementById('aba-oraculo');
            const grimorioDiv = document.getElementById('aba-grimorio');
            const btnOraculo = document.getElementById('btn-oraculo');
            const btnGrimorio = document.getElementById('btn-grimorio');

            if (aba === 'oraculo') {
                oraculoDiv.classList.remove('hidden');
                grimorioDiv.classList.add('hidden');
                btnOraculo.classList.add('active');
                btnGrimorio.classList.remove('active');
            } else {
                oraculoDiv.classList.add('hidden');
                grimorioDiv.classList.remove('hidden');
                btnOraculo.classList.remove('active');
                btnGrimorio.classList.add('active');
                renderizarGrimorio(); // Garante que a lista est√° renderizada
            }
        }

        // Renderizar Perfis
        function renderizarGrimorio() {
            const grid = document.getElementById('grid-perfis');
            if (grid.innerHTML.trim() !== '') return; // J√° renderizou

            pombagirasDB.forEach(pg => {
                const card = document.createElement('div');
                card.className = 'card-perfil';
                card.innerHTML = `
                    <h4>${pg.nome}</h4>
                    <div class="meta">${pg.titulo} | ${pg.dominio}</div>
                    <p>${pg.desc}</p>
                    <div class="detalhe-item">‚ú¶ ${pg.detalhes}</div>
                `;
                grid.appendChild(card);
            });
        }

        // Anima√ß√£o Chuva
        const emojis = ['üç∑', 'üî±', 'üåπ', 'üíÉ', 'üî•', 'üïØÔ∏è', 'üö¨', 'üåô', 'üíÄ', 'üó°Ô∏è'];
        function criarChuva() {
            const container = document.getElementById('chuva-container');
            setInterval(() => {
                const el = document.createElement('div');
                el.classList.add('elemento-chuva');
                el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
                el.style.left = Math.random() * 100 + 'vw';
                el.style.animationDuration = (Math.random() * 3 + 2) + 's';
                container.appendChild(el);
                setTimeout(() => el.remove(), 5000);
            }, 300);
        }

        // Troca de Cores
        const cores = ['var(--cor-roxo)', 'var(--cor-lilas)', 'var(--cor-vermelho)', 'var(--cor-preto)'];
        function mudarCorFundo() {
            document.body.style.backgroundColor = cores[Math.floor(Math.random() * cores.length)];
        }

        // Fun√ß√µes do Quiz
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function iniciarQuiz() {
            document.getElementById('tela-inicio').classList.add('hidden');
            document.getElementById('tela-quiz').classList.remove('hidden');
            perguntasSelecionadas = shuffle([...perguntasBase]).slice(0, 12);
            indiceAtual = 0;
            acertos = 0;
            mostrarPergunta();
        }

        function mostrarPergunta() {
            if (indiceAtual >= 12) { finalizarQuiz(); return; }
            const p = perguntasSelecionadas[indiceAtual];
            document.getElementById('nivel-display').innerText = `PERGUNTA ${indiceAtual + 1}/12`;
            document.getElementById('pergunta-texto').innerText = p.t;
            
            const div = document.getElementById('opcoes-container');
            div.innerHTML = '';
            shuffle([...p.o]).forEach(opcao => {
                const btn = document.createElement('button');
                btn.className = 'quiz-btn';
                btn.innerText = opcao;
                btn.onclick = function() { verificarResposta(this, opcao, p.r); };
                div.appendChild(btn);
            });
            document.getElementById('barra-progresso').style.width = ((indiceAtual)/12 * 100) + '%';
        }

        function verificarResposta(btn, escolha, correta) {
            const btns = document.querySelectorAll('#opcoes-container button');
            btns.forEach(b => b.disabled = true);
            mudarCorFundo();
            
            if (escolha === correta) {
                btn.classList.add('btn-correto');
                acertos++;
            } else {
                btn.classList.add('btn-incorreto');
            }
            setTimeout(() => { indiceAtual++; mostrarPergunta(); }, 1000);
        }

        function finalizarQuiz() {
            document.getElementById('tela-quiz').classList.add('hidden');
            document.getElementById('tela-resultado').classList.remove('hidden');
            document.getElementById('pontuacao-final').innerText = `${acertos} de 12 acertos`;
            
            const pg = pombagirasDB[Math.floor(Math.random() * pombagirasDB.length)];
            document.getElementById('oraculo-destino').innerHTML = `
                <div class="card-pombagira">
                    <h3>${pg.nome}</h3>
                    <p style="color:#ccc; font-size:0.9rem;">${pg.titulo}</p>
                    <div class="audio-msg">"${pg.msg}"</div>
                    <button class="quiz-btn" style="background:var(--cor-lilas); color:black;" 
                    onclick="lerMensagem('${pg.msg.replace(/'/g, "\\'")}')">üîä OUVIR MENSAGEM</button>
                </div>
            `;
        }

        function lerMensagem(texto) {
            if ('speechSynthesis' in window) {
                const u = new SpeechSynthesisUtterance(texto);
                u.lang = 'pt-BR'; u.rate = 0.9; u.pitch = 0.8;
                window.speechSynthesis.speak(u);
            }
        }

        /* --- CONTADOR SUPABASE (Mantido) --- */
        const SUPABASE_URL = 'https://qgnprifuachmfxoaalax.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnbnByaWZ1YWNobWZ4b2FhbGF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzODU5MDcsImV4cCI6MjA4MDk2MTkwN30.sKSYFhcI-zflr9RUKXpWF0_5sc6foDG7yxdEirtE0W4';
        const SITE_NAME = 'site_alexialuzdeferro';

        async function initCounter() {
            try {
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                if (!sessionStorage.getItem('site_visited')) {
                    await incrementUniqueCounter(supabase);
                    sessionStorage.setItem('site_visited', 'true');
                    document.getElementById('status-dot').classList.add('online');
                } else {
                    await showCurrentCount(supabase);
                    document.getElementById('status-dot').classList.add('online');
                }
            } catch (e) { useOfflineCounter(); }
        }

        async function incrementUniqueCounter(supabase) {
            const { data: existing } = await supabase.from('page_views').select('view_count').eq('page_name', SITE_NAME).single();
            const current = existing?.view_count || 0;
            const newCount = current + 1;
            await supabase.from('page_views').upsert({ page_name: SITE_NAME, view_count: newCount, last_updated: new Date().toISOString() }, { onConflict: 'page_name' });
            atualizarDisplay(newCount);
        }

        async function showCurrentCount(supabase) {
            const { data } = await supabase.from('page_views').select('view_count').eq('page_name', SITE_NAME).single();
            if (data) atualizarDisplay(data.view_count);
        }

        function atualizarDisplay(num) {
            const el = document.getElementById('count');
            el.textContent = num;
            el.style.transform = 'scale(1.3)';
            setTimeout(() => el.style.transform = 'scale(1)', 200);
        }

        function useOfflineCounter() {
            let local = localStorage.getItem('local_site_views') || 0;
            local = parseInt(local) + 1;
            localStorage.setItem('local_site_views', local);
            document.getElementById('count').textContent = local;
            document.getElementById('status-dot').style.background = '#fbbf24';
        }

        window.onload = () => { criarChuva(); initCounter(); };
    </script>
</body>
</html>
